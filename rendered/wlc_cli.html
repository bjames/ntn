<p>title: WLC CLI Cheatsheet published: 2019-07-30 category: - Wireless - Cheatsheets author: Brandon James summary: The WLC CLI can be a little less than intuitive at times. I put together this quick reference with some of my most used WLC commands.</p>
<p>I’m on the WLC CLI much less often than NXOS or IOS so I haven’t really committed all the commands to memory. This reference documents some of the useful things I do or have done in the past on the WLC CLI.</p>
<h3 id="useful-show-commands">Useful Show Commands</h3>
<ul>
<li>Instead of: <code>show command | include</code>, the WLC uses: <code>grep include _regex_ "show command"</code>
<ul>
<li>This is a really useful tool which makes it easy to do things like gather all the joined APs at a site to verify they are in the correct AP group</li>
<li>You can also do an inverse match with <code>grep exclude</code></li>
<li>The number of lines matched is reported at the end, this is useful for change validation</li>
</ul></li>
<li>List all WLANs: <code>show wlan</code></li>
<li>List all WLANs in an AP group: <code>show wlan apgroups</code></li>
<li>List all APs: <code>show ap summary</code>
<ul>
<li>List all APs in a specific subnet <code>grep include 10\.10\.10\. "show ap summary"</code></li>
</ul></li>
<li>Show WLANs broadcast by a specific AP on a specific radio type: <code>show ap wlan 802.11[a|b|-abgn] _AP-NAME_</code></li>
<li>List all FlexConnect Groups: <code>show flexconnect group summary</code></li>
<li>List all APs and AVC mappings in a FlexConnect Group: <code>show flexconnect group _GROUP-NAME_</code>
<ul>
<li>Appending ‘aps’ to the end of the command will list just the member APs</li>
</ul></li>
</ul>
<h3 id="ap-configuration">AP Configuration</h3>
<p>Generally APs should be configured automatically using the WLC, after all that’s the entire point of using a WLC. However, when cleaning up existing environments or migrating to a new environment, it might be necessary to configure the APs directly.</p>
<ul>
<li>Change an APs Primary Controller
<ul>
<li>This is useful for migrating APs to a new controller or to fail over your infrastructure to your secondary controller while leaving the original WLC online:</li>
</ul>
<pre><code>config ap primary-base DCA-WLC-01 BLG1-FLR1-AP1 192.168.0.20</code></pre>
<pre><code>config ap primary-base _CONTROLLER-NAS-ID_ _AP-NAME_ _CONTROLLER_IP_ADDRESS_</code></pre>
<ul>
<li><p>Your primary WLC and secondary WLC cannot be the same</p></li>
<li><p>Changing an APs Secondary Controller is similar:</p>
<pre><code>config ap secondary-base DCB-WLC-01 BLG1-FLR1-AP1 192.168.1.20</code></pre>
<ul>
<li><p>To remove a secondary controller you set the controller to a blank NAS-ID and use 0.0.0.0 as the IP address</p>
<pre><code>config ap secondary-base &#39;&#39; BLG1-FLR1-AP1 0.0.0.0</code></pre>
<ul>
<li>If your new primary controller is your old secondary controller, this has to be done first</li>
</ul></li>
</ul></li>
</ul></li>
<li>Change an APs Group Name <code>config ap group-name BLG1-AP-GROUP BLG1-FLR1-AP1</code>
<ul>
<li>config ap group-name <em>GROUP-NAME</em> <em>AP-NAME</em></li>
</ul></li>
<li>Change an APs Operational Mode <code>config ap mode flexconnect submode none BLG1-FLR1-AP1</code>
<ul>
<li>config ap mode <em>mode</em> submode <em>submode</em> <em>AP-NAME</em>
<ul>
<li>valid modes are: local, bridge, flex+bridge, flexconnect, monitor, rogue, se-connect, sensor, sniffer</li>
<li>valid submodes are: none, wips</li>
</ul></li>
</ul></li>
</ul>
<h4 id="making-batch-ap-configuration-changes-example-batch-migrating-aps-from-their-primary-controller-to-the-secondary">Making batch AP configuration changes (Example: Batch migrating APs from their primary controller to the secondary)</h4>
<p><em>The following example works on linux machines, but a similar process can also be performed using an excel spreadsheet</em></p>
<ul>
<li>Log into the WLC the APs are registered to, if you aren’t already logging ssh sessions, log the session as follows:
<ul>
<li><code>ssh DCA-WLC-01 | tee logfile.log</code></li>
</ul></li>
<li>Issue the following commands</li>
</ul>
<pre><code>config paging disable
show ap join stats summary all
logout</code></pre>
<ul>
<li><p>Then generate the script using the following:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1"></a><span class="fu">grep</span> -P <span class="st">&#39;192\.168\.20\.\d+.*\s{2}Joined&#39;</span> log.log \</span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;{print &quot;config ap secondary-base &#39;</span><span class="dt">\&#39;</span><span class="st">&#39; &#39;</span><span class="dt">\&#39;</span><span class="st">&#39; &quot; $3 &quot; 0.0.0.0\nconfig ap primary-base DCA-WLC-01 &quot; $3 &quot; 192.168.0.20\nconfig ap secondary-base DCB-WLC-01 &quot; $3 &quot; 192.168.1.20&quot;}&#39;</span> <span class="op">&gt;</span> paste_script.txt</span></code></pre></div>
<ul>
<li><p>Using grep, we select only APs in the 192.168.20.0/24 subnet that are currently joined to the controller:</p>
<ul>
<li>We also only want to modify APs that are actually joined to the controller, alternatively all joined APs can be grabbed with <code>grep -P '\s{2}Joined' log.log</code></li>
</ul></li>
<li><p>Then AWK to generate the script</p>
<pre><code>awk &#39;{print &quot;config ap secondary-base &#39;\&#39;&#39; &#39;\&#39;&#39; &quot; $3 &quot; 0.0.0.0\nconfig ap primary-base DCA-WLC-01 &quot; $3 &quot; 192.168.0.20\nconfig ap secondary-base DCB-WLC-01 &quot; $3 &quot; 192.168.1.20&quot;}&#39;</code></pre>
<ul>
<li>$3 represents column three, which contains the AP name</li>
<li>We first delete the old secondary, then configure the new primary and secondary controllers</li>
</ul></li>
<li><p>Finally, redirection is used to output the paste script into a file</p></li>
</ul></li>
</ul>
<p>A similar process can be used for other batch AP changes. Keep in mind that in cases where the AP has to reboot the character ‘y’ is required between commands. Example</p>
<pre><code>config ap group-name BLG1-AP-GROUP BLG1-FLR1-AP1
y
config ap group-name BLG1-AP-GROUP BLG1-FLR1-AP2
y</code></pre>
<ul>
<li>This is trivial to add to our awk script above. Simply add <code>"\n y \n"</code> to the end</li>
</ul>
