<h1 id="how-i-automate---concurrency">How I Automate - Concurrency</h1>
<p>Interacting with Network Devices can often be I/O limited. A function runs, waits for a response from the device, then another function runs so on and so forth. This is made worse by the fact that scripts are often run against multiple devices. After all the purpose of scripting is to speed up repetitive tasks.</p>
<p>One of the scripts I maintain is used to test the POTS lines my enterprise uses for out-of-band connectivity at our branches and call centers. Dial-up modems are slow, you make a call, the line rings, remote end picks up, the modems eventually train up and you finally get a connection. With some of our international locations I’ve seen this process take nearly a full minute. Before I added multiprocessing, this script could take over 2 hours to complete. Now it finishes in roughly 20 minutes.</p>
<p>I typically write scripts without concurrency first, using my little 3560-CX as a test device. Once the script is complete, I write a bit of logic to execute the script against multiple devices simultaneously. That logic is discussed below.</p>
<h3 id="using-the-multiprocessing-library">Using the Multiprocessing Library</h3>
<p>Python provides two easy ways to add concurrency to your scripts. The first is <a href="https://docs.python.org/3/library/threading.html">threading</a> and the second is <a href="https://docs.python.org/3/library/multiprocessing.html">multiprocessing</a>. I use the multiprocessing primarily because it offers an extremely convenient function called ‘Pool’. There are technical reason to use one over the other. Python has something called the Global Interpreter Lock or GIL. The GIL prevents more than one thread from controlling the Python interpreter at any given time. This means that for any CPU bound tasks, threading won’t provide much of a speedup. The multiprocessing library works around this by spawning one Python process per thread. Since Network Automation is IO bound, one could use the threading library, but I don’t mind the extra overhead and enjoy the convenience of the pool function.</p>
<h4 id="functools.partial">functools.partial()</h4>
<p>Partial takes a function and list of values (corresponding to the arguments the function takes) as input and then returns a new function with those arguments statically assigned.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1"></a><span class="im">from</span> functools <span class="im">import</span> partial</span>
<span id="cb1-2"><a href="#cb1-2"></a></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="kw">def</span> sum_four_digits(num1, num2, num3, num4):</span>
<span id="cb1-4"><a href="#cb1-4"></a>    <span class="bu">print</span> num1 <span class="op">+</span> num2 <span class="op">+</span> num3 <span class="op">+</span> num4</span>
<span id="cb1-5"><a href="#cb1-5"></a>    </span>
<span id="cb1-6"><a href="#cb1-6"></a>partial_one_free_variable <span class="op">=</span> partial(sum_four_digits, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)</span>
<span id="cb1-7"><a href="#cb1-7"></a>partial_no_free_variables <span class="op">=</span> partial(sum_four_digits, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>)</span></code></pre></div>
<p>Calling these two functions results in the following:</p>
<pre><code>&gt;&gt;&gt; partial_one_free_variable(0)
6
&gt;&gt;&gt; partial_one_free_variable(4)
10
&gt;&gt;&gt; partial_no_free_variables()
10</code></pre>
<p>partial_no_free_variables() will always use num1 = 1, num2 = 2, num3 = 3 and num4 = 4. Likewise, partial_one_free_variable will always use num1 = 1, num2 = 2 and num3 = 3. In this case, partial_one_free_variable ends up just adding 6 to whatever number we call it with.</p>
<p>My typical use case in scripting is to create functions that already have the username and password set so I can spawn processes using multiprocessing.pool().</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1"></a><span class="im">import</span> getpass, partial</span>
<span id="cb3-2"><a href="#cb3-2"></a></span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="kw">def</span> my_network_automation_function(script_settings, username, password):</span>
<span id="cb3-4"><a href="#cb3-4"></a></span>
<span id="cb3-5"><a href="#cb3-5"></a>    <span class="cf">pass</span></span>
<span id="cb3-6"><a href="#cb3-6"></a>    </span>
<span id="cb3-7"><a href="#cb3-7"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">&#39;__main__&#39;</span>:</span>
<span id="cb3-8"><a href="#cb3-8"></a></span>
<span id="cb3-9"><a href="#cb3-9"></a>    username <span class="op">=</span> getpass.getuser()</span>
<span id="cb3-10"><a href="#cb3-10"></a>    password <span class="op">=</span> getpass.getpass()</span>
<span id="cb3-11"><a href="#cb3-11"></a>    </span>
<span id="cb3-12"><a href="#cb3-12"></a>    partial_function <span class="op">=</span> partial(my_network_automation_function, username <span class="op">=</span> username, password <span class="op">=</span> password)</span></code></pre></div>
<h4 id="pool.map">pool.map()</h4>
<p>Map takes a function and an iterable as input, then based on the number of processes you’ve given it, it cuts the iterable (of length <em>n</em>) into <em>n/processes</em> chunks and then executes them in order. Putting this together with our previous example, we get:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1"></a><span class="im">from</span> functools <span class="im">import</span> partial</span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="im">from</span> time <span class="im">import</span> sleep</span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="im">from</span> multiprocessing <span class="im">import</span> Pool</span>
<span id="cb4-4"><a href="#cb4-4"></a></span>
<span id="cb4-5"><a href="#cb4-5"></a><span class="kw">def</span> sum_four_digits(num1, num2, num3, num4):</span>
<span id="cb4-6"><a href="#cb4-6"></a>    <span class="bu">print</span>(<span class="st">&#39;sleep for four seconds&#39;</span>)</span>
<span id="cb4-7"><a href="#cb4-7"></a>    sleep(<span class="dv">4</span>)</span>
<span id="cb4-8"><a href="#cb4-8"></a>    <span class="bu">print</span>(num1 <span class="op">+</span> num2 <span class="op">+</span> num3 <span class="op">+</span> num4)</span>
<span id="cb4-9"><a href="#cb4-9"></a>    </span>
<span id="cb4-10"><a href="#cb4-10"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">&#39;__main__&#39;</span>:</span>
<span id="cb4-11"><a href="#cb4-11"></a>    </span>
<span id="cb4-12"><a href="#cb4-12"></a>    partial_one_free_variable <span class="op">=</span> partial(sum_four_digits, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)</span>
<span id="cb4-13"><a href="#cb4-13"></a>    numbers <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>]</span>
<span id="cb4-14"><a href="#cb4-14"></a></span>
<span id="cb4-15"><a href="#cb4-15"></a>    number_of_processes <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb4-16"><a href="#cb4-16"></a></span>
<span id="cb4-17"><a href="#cb4-17"></a>    <span class="cf">with</span> Pool(number_of_processes) <span class="im">as</span> pool:</span>
<span id="cb4-18"><a href="#cb4-18"></a>        pool.<span class="bu">map</span>(partial_one_free_variable, numbers)</span></code></pre></div>
<p>I added sleep(4) to sum_four_digits in order to make the multiprocessing impact more obvious. The result of running this is as follows:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1"></a>[<span class="ex">bjames@lws1</span> ~]$ ./venv3/bin/python threaded.py </span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="fu">sleep</span> for four seconds</span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="fu">sleep</span> for four seconds</span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="fu">sleep</span> for four seconds</span>
<span id="cb5-5"><a href="#cb5-5"></a><span class="fu">sleep</span> for four seconds</span>
<span id="cb5-6"><a href="#cb5-6"></a><span class="ex">8</span></span>
<span id="cb5-7"><a href="#cb5-7"></a><span class="fu">sleep</span> for four seconds</span>
<span id="cb5-8"><a href="#cb5-8"></a><span class="ex">6</span></span>
<span id="cb5-9"><a href="#cb5-9"></a><span class="fu">sleep</span> for four seconds</span>
<span id="cb5-10"><a href="#cb5-10"></a><span class="ex">7</span></span>
<span id="cb5-11"><a href="#cb5-11"></a><span class="ex">9</span></span>
<span id="cb5-12"><a href="#cb5-12"></a><span class="fu">sleep</span> for four seconds</span>
<span id="cb5-13"><a href="#cb5-13"></a><span class="fu">sleep</span> for four seconds</span>
<span id="cb5-14"><a href="#cb5-14"></a><span class="ex">11</span></span>
<span id="cb5-15"><a href="#cb5-15"></a><span class="ex">12</span></span>
<span id="cb5-16"><a href="#cb5-16"></a><span class="ex">13</span></span>
<span id="cb5-17"><a href="#cb5-17"></a><span class="ex">14</span></span></code></pre></div>
<p>While the execution is in order, we don’t get the results in order. This is because computers do a lot and when 4 threads start up simultaneously there is no way to determine which one is going to finish first. This isn’t of much concern for two reasons.</p>
<ol type="1">
<li><p>When automating network tasks, it’s unlikely that your threads will complete at the same time. Different devices will take different amount of times to complete.</p></li>
<li><p>The map function handles this extremely well. If a result is returned from the function called using pool.map(). The results are stored in an array in the order of execution (as opposed to the order of completion).</p></li>
</ol>
<p>I’ve modified our example above to illustrate this:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1"></a><span class="im">from</span> functools <span class="im">import</span> partial</span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="im">from</span> time <span class="im">import</span> sleep</span>
<span id="cb6-3"><a href="#cb6-3"></a><span class="im">from</span> multiprocessing <span class="im">import</span> Pool</span>
<span id="cb6-4"><a href="#cb6-4"></a></span>
<span id="cb6-5"><a href="#cb6-5"></a><span class="kw">def</span> sum_four_digits(num1, num2, num3, num4):</span>
<span id="cb6-6"><a href="#cb6-6"></a></span>
<span id="cb6-7"><a href="#cb6-7"></a>    <span class="cf">return</span> num1 <span class="op">+</span> num2 <span class="op">+</span> num3 <span class="op">+</span> num4</span>
<span id="cb6-8"><a href="#cb6-8"></a>    </span>
<span id="cb6-9"><a href="#cb6-9"></a><span class="kw">def</span> main():</span>
<span id="cb6-10"><a href="#cb6-10"></a>    </span>
<span id="cb6-11"><a href="#cb6-11"></a>    partial_one_free_variable <span class="op">=</span> partial(sum_four_digits, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)</span>
<span id="cb6-12"><a href="#cb6-12"></a>    numbers <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>]</span>
<span id="cb6-13"><a href="#cb6-13"></a></span>
<span id="cb6-14"><a href="#cb6-14"></a>    number_of_processes <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb6-15"><a href="#cb6-15"></a></span>
<span id="cb6-16"><a href="#cb6-16"></a>    <span class="cf">with</span> Pool(number_of_processes) <span class="im">as</span> pool:</span>
<span id="cb6-17"><a href="#cb6-17"></a>        results <span class="op">=</span> pool.<span class="bu">map</span>(partial_one_free_variable, numbers)</span>
<span id="cb6-18"><a href="#cb6-18"></a></span>
<span id="cb6-19"><a href="#cb6-19"></a>    <span class="bu">print</span>(results)</span>
<span id="cb6-20"><a href="#cb6-20"></a></span>
<span id="cb6-21"><a href="#cb6-21"></a>main()</span></code></pre></div>
<p>Which yields the following:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1"></a>[<span class="ex">bjames@lws1</span> ~]$ ./venv3/bin/python threaded.py </span>
<span id="cb7-2"><a href="#cb7-2"></a>[<span class="ex">6</span>, 7, 8, 9, 11, 12, 13, 14]</span></code></pre></div>
<p>pool.map() waits until all processes have completed before returning. For automation, that’s generally what I want. Just for awareness, I’ll mention that pool.map_async() returns a MapResult object immediately. This allows you to execute other code in your parent processes, but you still won’t be able to operate on the results until all the processes have terminated. There are cases where this can be useful.</p>
<p>I won’t go into much detail, but the use of pool.map_async() is shown below:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1"></a><span class="cf">with</span> Pool(number_of_processes) <span class="im">as</span> pool:</span>
<span id="cb8-2"><a href="#cb8-2"></a></span>
<span id="cb8-3"><a href="#cb8-3"></a>    results <span class="op">=</span> pool.map_async(partial_one_free_variable, numbers)</span>
<span id="cb8-4"><a href="#cb8-4"></a></span>
<span id="cb8-5"><a href="#cb8-5"></a>    <span class="bu">print</span>(<span class="st">&#39;we are now executing other code&#39;</span>)</span>
<span id="cb8-6"><a href="#cb8-6"></a></span>
<span id="cb8-7"><a href="#cb8-7"></a>    <span class="co"># prints the results once they are avaliable</span></span>
<span id="cb8-8"><a href="#cb8-8"></a>    <span class="bu">print</span>(results.get())</span></code></pre></div>
<p>This results in roughly the same thing as the pool.map() function, but to get the results, we call results.get() which waits for the result to be available, then it returns it. There are ways to share data between threads, which could be used to act on data as soon as it’s available, but that’s not in the scope of this post.</p>
<h3 id="structuring-your-code-for-concurrency">Structuring your Code for Concurrency</h3>
<p>Parallel code has to be structured differently than serial code. There are times where you can simply use pool.map() to call the function you want to use multiprocessing on and as I mentioned before, I don’t add concurrency until the very end. However, there are some things you should keep in mind as you work.</p>
<h4 id="validate-your-credentials-before-spawning-processes">Validate your credentials before spawning processes</h4>
<p>In my organization, our scripts generally aren’t run by any sort of automated process. They tend to be run under a user’s account who has R/W access to the network devices being modified. During the change window, the user logs on, runs the script which then prompts them for credentials (this isn’t entirely true - I’ve written a submodule that gets the credentials ahead of time and simply sleeps until the change window). The worst thing that could happen at this point is for the script to try to log on to 8 devices simultaneously and locking out their account because they accidentally hit caps lock.</p>
<p>In order to avoid that situation, I use a function called get_validate_credentials(), which returns credentials that we know are valid:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1"></a><span class="kw">def</span> get_validate_credentials(device):</span>
<span id="cb9-2"><a href="#cb9-2"></a></span>
<span id="cb9-3"><a href="#cb9-3"></a>    <span class="co">&#39;&#39;&#39; </span></span>
<span id="cb9-4"><a href="#cb9-4"></a><span class="co">        gets username and password, opens an ssh session to verify the credentials, then closes the ssh session</span></span>
<span id="cb9-5"><a href="#cb9-5"></a><span class="co">        returns username and password</span></span>
<span id="cb9-6"><a href="#cb9-6"></a><span class="co">        Doing this prevents multiple threads from locking out an account due to mistyped creds</span></span>
<span id="cb9-7"><a href="#cb9-7"></a><span class="co">    &#39;&#39;&#39;</span></span>
<span id="cb9-8"><a href="#cb9-8"></a></span>
<span id="cb9-9"><a href="#cb9-9"></a>    <span class="co"># attempts to get the username, prompts if needed</span></span>
<span id="cb9-10"><a href="#cb9-10"></a>    username <span class="op">=</span> getpass.getuser()</span>
<span id="cb9-11"><a href="#cb9-11"></a></span>
<span id="cb9-12"><a href="#cb9-12"></a>    <span class="co"># prompts user for password</span></span>
<span id="cb9-13"><a href="#cb9-13"></a>    password <span class="op">=</span> getpass.getpass()</span>
<span id="cb9-14"><a href="#cb9-14"></a></span>
<span id="cb9-15"><a href="#cb9-15"></a>    authenticated <span class="op">=</span> <span class="va">False</span></span>
<span id="cb9-16"><a href="#cb9-16"></a></span>
<span id="cb9-17"><a href="#cb9-17"></a>    <span class="cf">while</span> <span class="kw">not</span> authenticated:</span>
<span id="cb9-18"><a href="#cb9-18"></a></span>
<span id="cb9-19"><a href="#cb9-19"></a>        <span class="cf">try</span>:</span>
<span id="cb9-20"><a href="#cb9-20"></a>            </span>
<span id="cb9-21"><a href="#cb9-21"></a>            test_ssh_session <span class="op">=</span> ssh_connect(device, username, password)</span>
<span id="cb9-22"><a href="#cb9-22"></a>            test_ssh_session.disconnect()</span>
<span id="cb9-23"><a href="#cb9-23"></a></span>
<span id="cb9-24"><a href="#cb9-24"></a>        <span class="cf">except</span> NetMikoAuthenticationException:</span>
<span id="cb9-25"><a href="#cb9-25"></a></span>
<span id="cb9-26"><a href="#cb9-26"></a>            <span class="bu">print</span> <span class="st">&#39;authentication failed on &#39;</span> <span class="op">+</span> device <span class="op">+</span> <span class="st">&#39; (CTRL + C to quit)&#39;</span></span>
<span id="cb9-27"><a href="#cb9-27"></a></span>
<span id="cb9-28"><a href="#cb9-28"></a>            username <span class="op">=</span> <span class="bu">raw_input</span>(<span class="st">&#39;Username: &#39;</span>)</span>
<span id="cb9-29"><a href="#cb9-29"></a>            password <span class="op">=</span> getpass.getpass()</span>
<span id="cb9-30"><a href="#cb9-30"></a></span>
<span id="cb9-31"><a href="#cb9-31"></a>        <span class="cf">except</span> NetMikoTimeoutException:</span>
<span id="cb9-32"><a href="#cb9-32"></a></span>
<span id="cb9-33"><a href="#cb9-33"></a>            <span class="bu">print</span> <span class="st">&#39;SSH timed out on &#39;</span> <span class="op">+</span> device</span>
<span id="cb9-34"><a href="#cb9-34"></a>            <span class="cf">raise</span></span>
<span id="cb9-35"><a href="#cb9-35"></a></span>
<span id="cb9-36"><a href="#cb9-36"></a>        <span class="cf">else</span>:</span>
<span id="cb9-37"><a href="#cb9-37"></a></span>
<span id="cb9-38"><a href="#cb9-38"></a>            <span class="co"># if there is no exception set authenticated to true</span></span>
<span id="cb9-39"><a href="#cb9-39"></a>            authenticated <span class="op">=</span> <span class="va">True</span></span>
<span id="cb9-40"><a href="#cb9-40"></a></span>
<span id="cb9-41"><a href="#cb9-41"></a>    <span class="cf">return</span> username, password</span></code></pre></div>
<h4 id="make-the-number-of-threads-configurable">Make the number of threads configurable</h4>
<p>Different scenarios call for a different number of threads. For instance, I regularly run our IOS upgrade script with a single thread, because if I’m upgrading a single site I want to do the closet switches before the distribution switches, otherwise I may end up rebooting the distribution while the new code is still being transferred to the closets. I typically use <a href="https://neverthenetwork.com/notes/automation_config">YAML for script configuration</a>.</p>
<h4 id="shore-up-your-exception-handling">Shore up your exception handling</h4>
<p>Exceptions occur on a per process basis (at least using the pool.map() function). Some of my scripts connect to devices more than once during the execution and often in different threads. If an exception occurs early on in the script, I don’t want to allow later parts of the script to run against that device, but I do want the script to continue executing.</p>
<p>I’ll often use an array of dictionaries to store both the results and settings of the script. Within that dictionary, I keep track of any exceptions that occur within my child threads. A simple example of this follows:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1"></a></span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="im">from</span> functools <span class="im">import</span> partial</span>
<span id="cb10-3"><a href="#cb10-3"></a><span class="im">from</span> time <span class="im">import</span> sleep</span>
<span id="cb10-4"><a href="#cb10-4"></a><span class="im">from</span> multiprocessing <span class="im">import</span> Pool</span>
<span id="cb10-5"><a href="#cb10-5"></a><span class="im">from</span> random <span class="im">import</span> randint</span>
<span id="cb10-6"><a href="#cb10-6"></a></span>
<span id="cb10-7"><a href="#cb10-7"></a><span class="kw">def</span> snooze(sleep_time):</span>
<span id="cb10-8"><a href="#cb10-8"></a></span>
<span id="cb10-9"><a href="#cb10-9"></a>    <span class="co">&#39;&#39;&#39;</span></span>
<span id="cb10-10"><a href="#cb10-10"></a><span class="co">        calls time.sleep() using sleep_time as the amount of time to sleep</span></span>
<span id="cb10-11"><a href="#cb10-11"></a><span class="co">        raises a value error if we try to sleep more than 5 seconds</span></span>
<span id="cb10-12"><a href="#cb10-12"></a><span class="co">    &#39;&#39;&#39;</span></span>
<span id="cb10-13"><a href="#cb10-13"></a></span>
<span id="cb10-14"><a href="#cb10-14"></a>    <span class="cf">if</span> sleep_time <span class="op">&gt;</span> <span class="dv">5</span>:</span>
<span id="cb10-15"><a href="#cb10-15"></a></span>
<span id="cb10-16"><a href="#cb10-16"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">&quot;We can&#39;t sleep in!&quot;</span>)</span>
<span id="cb10-17"><a href="#cb10-17"></a></span>
<span id="cb10-18"><a href="#cb10-18"></a>    sleep(sleep_time)</span>
<span id="cb10-19"><a href="#cb10-19"></a></span>
<span id="cb10-20"><a href="#cb10-20"></a><span class="kw">def</span> sum_four_digits(num1, num2, num3, function_values):</span>
<span id="cb10-21"><a href="#cb10-21"></a></span>
<span id="cb10-22"><a href="#cb10-22"></a>    <span class="co">&#39;&#39;&#39;</span></span>
<span id="cb10-23"><a href="#cb10-23"></a><span class="co">        takes three numbers and a dictionary as input</span></span>
<span id="cb10-24"><a href="#cb10-24"></a><span class="co">        the dictionary MUST have a key called number containing an int</span></span>
<span id="cb10-25"><a href="#cb10-25"></a><span class="co">        otherwise a KeyError will be raised</span></span>
<span id="cb10-26"><a href="#cb10-26"></a><span class="co">    &#39;&#39;&#39;</span></span>
<span id="cb10-27"><a href="#cb10-27"></a></span>
<span id="cb10-28"><a href="#cb10-28"></a></span>
<span id="cb10-29"><a href="#cb10-29"></a>    sleep_time <span class="op">=</span> randint(<span class="dv">1</span>,<span class="dv">10</span>)</span>
<span id="cb10-30"><a href="#cb10-30"></a>    </span>
<span id="cb10-31"><a href="#cb10-31"></a>    <span class="cf">try</span>:</span>
<span id="cb10-32"><a href="#cb10-32"></a></span>
<span id="cb10-33"><a href="#cb10-33"></a>        snooze(sleep_time)</span>
<span id="cb10-34"><a href="#cb10-34"></a></span>
<span id="cb10-35"><a href="#cb10-35"></a>    <span class="co"># if you need the exception message, it can be added to the dictionary as well</span></span>
<span id="cb10-36"><a href="#cb10-36"></a>    <span class="cf">except</span> <span class="pp">ValueError</span> <span class="im">as</span> e:</span>
<span id="cb10-37"><a href="#cb10-37"></a></span>
<span id="cb10-38"><a href="#cb10-38"></a>        function_values[<span class="st">&#39;exception&#39;</span>] <span class="op">=</span> e</span>
<span id="cb10-39"><a href="#cb10-39"></a></span>
<span id="cb10-40"><a href="#cb10-40"></a>    <span class="cf">else</span>:</span>
<span id="cb10-41"><a href="#cb10-41"></a>        </span>
<span id="cb10-42"><a href="#cb10-42"></a>        <span class="cf">try</span>:</span>
<span id="cb10-43"><a href="#cb10-43"></a>            </span>
<span id="cb10-44"><a href="#cb10-44"></a>            function_values[<span class="st">&#39;sum&#39;</span>] <span class="op">=</span> num1 <span class="op">+</span> num2 <span class="op">+</span> num3 <span class="op">+</span> function_values[<span class="st">&#39;number&#39;</span>]</span>
<span id="cb10-45"><a href="#cb10-45"></a></span>
<span id="cb10-46"><a href="#cb10-46"></a>        <span class="co"># note the we don&#39;t have to keep the exception text</span></span>
<span id="cb10-47"><a href="#cb10-47"></a>        <span class="cf">except</span> <span class="pp">KeyError</span> <span class="im">as</span> e:</span>
<span id="cb10-48"><a href="#cb10-48"></a></span>
<span id="cb10-49"><a href="#cb10-49"></a>            function_values[<span class="st">&#39;exception&#39;</span>] <span class="op">=</span> e</span>
<span id="cb10-50"><a href="#cb10-50"></a></span>
<span id="cb10-51"><a href="#cb10-51"></a>    <span class="cf">finally</span>:</span>
<span id="cb10-52"><a href="#cb10-52"></a></span>
<span id="cb10-53"><a href="#cb10-53"></a>        <span class="cf">return</span> function_values</span>
<span id="cb10-54"><a href="#cb10-54"></a>    </span>
<span id="cb10-55"><a href="#cb10-55"></a><span class="kw">def</span> main():</span>
<span id="cb10-56"><a href="#cb10-56"></a></span>
<span id="cb10-57"><a href="#cb10-57"></a>    <span class="co"># in practice this would be imported from a YAML file</span></span>
<span id="cb10-58"><a href="#cb10-58"></a>    script_values <span class="op">=</span> [</span>
<span id="cb10-59"><a href="#cb10-59"></a>                        {<span class="st">&#39;number&#39;</span>: <span class="dv">0</span>},</span>
<span id="cb10-60"><a href="#cb10-60"></a>                        {<span class="st">&#39;number&#39;</span>: <span class="dv">1</span>},</span>
<span id="cb10-61"><a href="#cb10-61"></a>                        {<span class="st">&#39;number&#39;</span>: <span class="dv">2</span>},</span>
<span id="cb10-62"><a href="#cb10-62"></a>                        {<span class="st">&#39;number&#39;</span>: <span class="dv">3</span>},</span>
<span id="cb10-63"><a href="#cb10-63"></a>                        {<span class="st">&#39;number&#39;</span>: <span class="dv">4</span>},</span>
<span id="cb10-64"><a href="#cb10-64"></a>                        {<span class="st">&#39;numbers&#39;</span>: <span class="dv">5</span>},</span>
<span id="cb10-65"><a href="#cb10-65"></a>                        {<span class="st">&#39;number&#39;</span>: <span class="dv">6</span>},</span>
<span id="cb10-66"><a href="#cb10-66"></a>                        {<span class="st">&#39;number&#39;</span>: <span class="dv">7</span>},</span>
<span id="cb10-67"><a href="#cb10-67"></a>                        {<span class="st">&#39;number&#39;</span>: <span class="dv">8</span>}</span>
<span id="cb10-68"><a href="#cb10-68"></a>                    ]</span>
<span id="cb10-69"><a href="#cb10-69"></a></span>
<span id="cb10-70"><a href="#cb10-70"></a>    number_of_processes <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb10-71"><a href="#cb10-71"></a></span>
<span id="cb10-72"><a href="#cb10-72"></a>    <span class="cf">with</span> Pool(number_of_processes) <span class="im">as</span> pool:</span>
<span id="cb10-73"><a href="#cb10-73"></a>        </span>
<span id="cb10-74"><a href="#cb10-74"></a>        <span class="co"># call map on a copy of sum_four_digits() where 1, 2 and 3 are already set</span></span>
<span id="cb10-75"><a href="#cb10-75"></a>        script_values <span class="op">=</span> pool.<span class="bu">map</span>(partial(sum_four_digits, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>), script_values)</span>
<span id="cb10-76"><a href="#cb10-76"></a></span>
<span id="cb10-77"><a href="#cb10-77"></a>    <span class="cf">for</span> value <span class="kw">in</span> script_values:</span>
<span id="cb10-78"><a href="#cb10-78"></a></span>
<span id="cb10-79"><a href="#cb10-79"></a>        <span class="co"># This key only exists if an exception occurred</span></span>
<span id="cb10-80"><a href="#cb10-80"></a>        <span class="cf">if</span> value.get(<span class="st">&#39;exception&#39;</span>) <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb10-81"><a href="#cb10-81"></a></span>
<span id="cb10-82"><a href="#cb10-82"></a>            <span class="bu">print</span>(<span class="bu">repr</span>(value[<span class="st">&#39;exception&#39;</span>]))</span>
<span id="cb10-83"><a href="#cb10-83"></a></span>
<span id="cb10-84"><a href="#cb10-84"></a>        <span class="cf">else</span>:</span>
<span id="cb10-85"><a href="#cb10-85"></a></span>
<span id="cb10-86"><a href="#cb10-86"></a>            <span class="bu">print</span>(<span class="st">&#39;1 + 2 + 3 + &#39;</span> <span class="op">+</span> <span class="bu">str</span>(value[<span class="st">&#39;number&#39;</span>]) <span class="op">+</span> <span class="st">&#39; = &#39;</span> <span class="op">+</span> <span class="bu">str</span>(value[<span class="st">&#39;sum&#39;</span>]))</span>
<span id="cb10-87"><a href="#cb10-87"></a></span>
<span id="cb10-88"><a href="#cb10-88"></a>main()</span></code></pre></div>
<p>If you run the code above, you might get something like the following:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1"></a>[<span class="ex">bjames@lws1</span> ~]$ ./venv3/bin/python threaded.py </span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="ex">1</span> + 2 + 3 + 0 = 6</span>
<span id="cb11-3"><a href="#cb11-3"></a><span class="ex">ValueError</span>(<span class="st">&quot;We can&#39;t sleep in!&quot;</span>)</span>
<span id="cb11-4"><a href="#cb11-4"></a><span class="ex">1</span> + 2 + 3 + 2 = 8</span>
<span id="cb11-5"><a href="#cb11-5"></a><span class="ex">ValueError</span>(<span class="st">&quot;We can&#39;t sleep in!&quot;</span>)</span>
<span id="cb11-6"><a href="#cb11-6"></a><span class="ex">ValueError</span>(<span class="st">&quot;We can&#39;t sleep in!&quot;</span>)</span>
<span id="cb11-7"><a href="#cb11-7"></a><span class="ex">KeyError</span>(<span class="st">&#39;number&#39;</span>)</span>
<span id="cb11-8"><a href="#cb11-8"></a><span class="ex">1</span> + 2 + 3 + 6 = 12</span>
<span id="cb11-9"><a href="#cb11-9"></a><span class="ex">ValueError</span>(<span class="st">&quot;We can&#39;t sleep in!&quot;</span>)</span>
<span id="cb11-10"><a href="#cb11-10"></a><span class="ex">1</span> + 2 + 3 + 8 = 14</span></code></pre></div>
<p>This results in us being able to either take actions due to an error that occurred on a device or avoid applying further changes to that device.</p>
<h4 id="putting-it-all-together">Putting it all together</h4>
<p>I’ve written a simple script to update existing ACLs on both IOS and NXOS to illustrate how this works in the context of Network Automation. This is actually very similar to the script I wrote to automate ACL pushes at work. In this script we:</p>
<ol type="1">
<li><p>Read the scripts configuration from a YAML file</p></li>
<li><p>Prompt for credentials</p></li>
<li><p>Verify the credentials are valid (using a submodule that’s similar to the example I gave earlier)</p></li>
<li><p>Spawn <em>n</em> processes based on the script’s configuration</p></li>
<li><p>Simultanuously update the ACLs on <em>n</em> devices</p></li>
<li><p>Print the results to the screen. Here I just used Pretty Print, but at work I’ll often have the script send an email upon completion.</p></li>
</ol>
<div class="sourceCode" id="cb12"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1"></a><span class="im">from</span> multiprocessing <span class="im">import</span> Pool</span>
<span id="cb12-2"><a href="#cb12-2"></a><span class="im">from</span> functools <span class="im">import</span> partial</span>
<span id="cb12-3"><a href="#cb12-3"></a><span class="im">from</span> contextlib <span class="im">import</span> contextmanager</span>
<span id="cb12-4"><a href="#cb12-4"></a><span class="im">from</span> netmiko <span class="im">import</span> NetMikoTimeoutException, ConnectHandler</span>
<span id="cb12-5"><a href="#cb12-5"></a><span class="im">from</span> yaml <span class="im">import</span> safe_load</span>
<span id="cb12-6"><a href="#cb12-6"></a><span class="im">from</span> pprint <span class="im">import</span> pprint</span>
<span id="cb12-7"><a href="#cb12-7"></a></span>
<span id="cb12-8"><a href="#cb12-8"></a><span class="im">from</span> bjames_netmiko_auth.bjames_netmiko_auth <span class="im">import</span> get_valid_credentials</span>
<span id="cb12-9"><a href="#cb12-9"></a></span>
<span id="cb12-10"><a href="#cb12-10"></a><span class="kw">def</span> connect_ssh(hostname, device_type, username, password):</span>
<span id="cb12-11"><a href="#cb12-11"></a></span>
<span id="cb12-12"><a href="#cb12-12"></a>    device <span class="op">=</span> {</span>
<span id="cb12-13"><a href="#cb12-13"></a>        <span class="st">&#39;device_type&#39;</span>: device_type,</span>
<span id="cb12-14"><a href="#cb12-14"></a>        <span class="st">&#39;ip&#39;</span>: hostname,</span>
<span id="cb12-15"><a href="#cb12-15"></a>        <span class="st">&#39;username&#39;</span>: username,</span>
<span id="cb12-16"><a href="#cb12-16"></a>        <span class="st">&#39;password&#39;</span>: password</span>
<span id="cb12-17"><a href="#cb12-17"></a>    }</span>
<span id="cb12-18"><a href="#cb12-18"></a></span>
<span id="cb12-19"><a href="#cb12-19"></a>    <span class="cf">return</span> ConnectHandler(<span class="op">**</span>device)</span>
<span id="cb12-20"><a href="#cb12-20"></a></span>
<span id="cb12-21"><a href="#cb12-21"></a></span>
<span id="cb12-22"><a href="#cb12-22"></a><span class="kw">def</span> nxos_mod_acl(ssh_session, device, acl_name, acl_lines):</span>
<span id="cb12-23"><a href="#cb12-23"></a></span>
<span id="cb12-24"><a href="#cb12-24"></a>    <span class="co"># remove the old ACL</span></span>
<span id="cb12-25"><a href="#cb12-25"></a>    ssh_session.send_config_set(<span class="st">&#39;no ip access-list </span><span class="sc">{}</span><span class="st">&#39;</span>.<span class="bu">format</span>(acl_name))</span>
<span id="cb12-26"><a href="#cb12-26"></a></span>
<span id="cb12-27"><a href="#cb12-27"></a>    <span class="co"># create the config set for the new ACL</span></span>
<span id="cb12-28"><a href="#cb12-28"></a>    config_set <span class="op">=</span> [<span class="st">&#39;ip access-list </span><span class="sc">{}</span><span class="st">&#39;</span>.<span class="bu">format</span>(acl_name)]</span>
<span id="cb12-29"><a href="#cb12-29"></a>    config_set <span class="op">=</span> config_set <span class="op">+</span> acl_lines.splitlines()</span>
<span id="cb12-30"><a href="#cb12-30"></a></span>
<span id="cb12-31"><a href="#cb12-31"></a>    ssh_session.send_config_set(config_set)</span>
<span id="cb12-32"><a href="#cb12-32"></a></span>
<span id="cb12-33"><a href="#cb12-33"></a>    result <span class="op">=</span> ssh_session.send_command(<span class="st">&#39;show ip access-list </span><span class="sc">{}</span><span class="st">&#39;</span>.<span class="bu">format</span>(acl_name))</span>
<span id="cb12-34"><a href="#cb12-34"></a></span>
<span id="cb12-35"><a href="#cb12-35"></a>    <span class="cf">return</span> result</span>
<span id="cb12-36"><a href="#cb12-36"></a></span>
<span id="cb12-37"><a href="#cb12-37"></a></span>
<span id="cb12-38"><a href="#cb12-38"></a><span class="kw">def</span> ios_mod_acl(ssh_session, device, acl_name, acl_lines):</span>
<span id="cb12-39"><a href="#cb12-39"></a></span>
<span id="cb12-40"><a href="#cb12-40"></a>    <span class="co"># remove the old ACL</span></span>
<span id="cb12-41"><a href="#cb12-41"></a>    ssh_session.send_config_set(<span class="st">&#39;no ip access-list extended </span><span class="sc">{}</span><span class="st">&#39;</span>.<span class="bu">format</span>(acl_name))</span>
<span id="cb12-42"><a href="#cb12-42"></a></span>
<span id="cb12-43"><a href="#cb12-43"></a>    <span class="co"># create the config set for the new ACL</span></span>
<span id="cb12-44"><a href="#cb12-44"></a>    config_set <span class="op">=</span> [<span class="st">&#39;ip access-list extended </span><span class="sc">{}</span><span class="st">&#39;</span>.<span class="bu">format</span>(acl_name)]</span>
<span id="cb12-45"><a href="#cb12-45"></a>    config_set <span class="op">=</span> config_set <span class="op">+</span> acl_lines.splitlines()</span>
<span id="cb12-46"><a href="#cb12-46"></a></span>
<span id="cb12-47"><a href="#cb12-47"></a>    ssh_session.send_config_set(config_set)</span>
<span id="cb12-48"><a href="#cb12-48"></a></span>
<span id="cb12-49"><a href="#cb12-49"></a>    result <span class="op">=</span> ssh_session.send_command(<span class="st">&#39;show ip access-list </span><span class="sc">{}</span><span class="st">&#39;</span>.<span class="bu">format</span>(acl_name))</span>
<span id="cb12-50"><a href="#cb12-50"></a></span>
<span id="cb12-51"><a href="#cb12-51"></a>    <span class="cf">return</span> result</span>
<span id="cb12-52"><a href="#cb12-52"></a></span>
<span id="cb12-53"><a href="#cb12-53"></a></span>
<span id="cb12-54"><a href="#cb12-54"></a><span class="kw">def</span> mod_acl(acl_name, acl_lines, username, password, device):</span>
<span id="cb12-55"><a href="#cb12-55"></a></span>
<span id="cb12-56"><a href="#cb12-56"></a>    <span class="cf">try</span>:</span>
<span id="cb12-57"><a href="#cb12-57"></a></span>
<span id="cb12-58"><a href="#cb12-58"></a>        ssh_session <span class="op">=</span> connect_ssh(device[<span class="st">&#39;hostname&#39;</span>], device[<span class="st">&#39;device_type&#39;</span>], username, password)</span>
<span id="cb12-59"><a href="#cb12-59"></a></span>
<span id="cb12-60"><a href="#cb12-60"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb12-61"><a href="#cb12-61"></a></span>
<span id="cb12-62"><a href="#cb12-62"></a>        <span class="bu">print</span>(<span class="st">&#39;error </span><span class="sc">{}</span><span class="st">&#39;</span>.<span class="bu">format</span>(device[<span class="st">&#39;hostname&#39;</span>]))</span>
<span id="cb12-63"><a href="#cb12-63"></a>        <span class="cf">return</span> {<span class="st">&#39;device&#39;</span>: device[<span class="st">&#39;hostname&#39;</span>], <span class="st">&#39;result&#39;</span>: e}</span>
<span id="cb12-64"><a href="#cb12-64"></a></span>
<span id="cb12-65"><a href="#cb12-65"></a></span>
<span id="cb12-66"><a href="#cb12-66"></a>    <span class="cf">try</span>:</span>
<span id="cb12-67"><a href="#cb12-67"></a></span>
<span id="cb12-68"><a href="#cb12-68"></a>        <span class="cf">if</span> device[<span class="st">&#39;device_type&#39;</span>] <span class="op">==</span> <span class="st">&#39;cisco_ios&#39;</span>:</span>
<span id="cb12-69"><a href="#cb12-69"></a></span>
<span id="cb12-70"><a href="#cb12-70"></a>            result <span class="op">=</span> ios_mod_acl(ssh_session, device, acl_name, acl_lines)</span>
<span id="cb12-71"><a href="#cb12-71"></a></span>
<span id="cb12-72"><a href="#cb12-72"></a>        <span class="cf">elif</span> device[<span class="st">&#39;device_type&#39;</span>] <span class="op">==</span> <span class="st">&#39;cisco_nxos&#39;</span>:</span>
<span id="cb12-73"><a href="#cb12-73"></a></span>
<span id="cb12-74"><a href="#cb12-74"></a>            result <span class="op">=</span> nxos_mod_acl(ssh_session, device, acl_name, acl_lines)</span>
<span id="cb12-75"><a href="#cb12-75"></a></span>
<span id="cb12-76"><a href="#cb12-76"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb12-77"><a href="#cb12-77"></a></span>
<span id="cb12-78"><a href="#cb12-78"></a>        <span class="bu">print</span>(<span class="st">&#39;error </span><span class="sc">{}</span><span class="st">&#39;</span>.<span class="bu">format</span>(device[<span class="st">&#39;hostname&#39;</span>]))</span>
<span id="cb12-79"><a href="#cb12-79"></a>        <span class="cf">return</span> {<span class="st">&#39;device&#39;</span>: device[<span class="st">&#39;hostname&#39;</span>], <span class="st">&#39;result&#39;</span>: e}</span>
<span id="cb12-80"><a href="#cb12-80"></a></span>
<span id="cb12-81"><a href="#cb12-81"></a>    <span class="bu">print</span>(<span class="st">&#39;</span><span class="sc">{}</span><span class="st"> completed&#39;</span>.<span class="bu">format</span>(device[<span class="st">&#39;hostname&#39;</span>]))</span>
<span id="cb12-82"><a href="#cb12-82"></a></span>
<span id="cb12-83"><a href="#cb12-83"></a>    <span class="cf">return</span> {<span class="st">&#39;device&#39;</span>: device[<span class="st">&#39;hostname&#39;</span>], <span class="st">&#39;result&#39;</span>: result}</span>
<span id="cb12-84"><a href="#cb12-84"></a></span>
<span id="cb12-85"><a href="#cb12-85"></a></span>
<span id="cb12-86"><a href="#cb12-86"></a><span class="kw">def</span> main():</span>
<span id="cb12-87"><a href="#cb12-87"></a></span>
<span id="cb12-88"><a href="#cb12-88"></a>    script_settings <span class="op">=</span> safe_load(<span class="bu">open</span>(<span class="st">&#39;mod_acl.yml&#39;</span>))</span>
<span id="cb12-89"><a href="#cb12-89"></a>    username, password <span class="op">=</span> get_valid_credentials(admin<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb12-90"><a href="#cb12-90"></a></span>
<span id="cb12-91"><a href="#cb12-91"></a>    <span class="cf">with</span> Pool(script_settings[<span class="st">&#39;threads&#39;</span>]) <span class="im">as</span> pool:</span>
<span id="cb12-92"><a href="#cb12-92"></a></span>
<span id="cb12-93"><a href="#cb12-93"></a>        results <span class="op">=</span> pool.<span class="bu">map</span>(partial(mod_acl,</span>
<span id="cb12-94"><a href="#cb12-94"></a>                         script_settings[<span class="st">&#39;acl_name&#39;</span>],</span>
<span id="cb12-95"><a href="#cb12-95"></a>                         script_settings[<span class="st">&#39;acl_lines&#39;</span>],</span>
<span id="cb12-96"><a href="#cb12-96"></a>                         username,</span>
<span id="cb12-97"><a href="#cb12-97"></a>                         password),</span>
<span id="cb12-98"><a href="#cb12-98"></a>                 script_settings[<span class="st">&#39;device_list&#39;</span>])</span>
<span id="cb12-99"><a href="#cb12-99"></a></span>
<span id="cb12-100"><a href="#cb12-100"></a>    pprint(results)</span></code></pre></div>
<p>And here’s an example configuration file:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb13-1"><a href="#cb13-1"></a><span class="co"># The name of the ACL</span></span>
<span id="cb13-2"><a href="#cb13-2"></a><span class="fu">threads</span><span class="kw">:</span><span class="at"> </span><span class="dv">8</span></span>
<span id="cb13-3"><a href="#cb13-3"></a><span class="co"># valid device types are cisco_ios and cisco_nxos</span></span>
<span id="cb13-4"><a href="#cb13-4"></a><span class="fu">device_list</span><span class="kw">:</span></span>
<span id="cb13-5"><a href="#cb13-5"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">hostname</span><span class="kw">:</span><span class="at"> BRANCH1_DIST1</span></span>
<span id="cb13-6"><a href="#cb13-6"></a><span class="at">      </span><span class="fu">device_type</span><span class="kw">:</span><span class="at"> cisco_ios</span></span>
<span id="cb13-7"><a href="#cb13-7"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">hostname</span><span class="kw">:</span><span class="at"> BRANCH1_DIST2</span></span>
<span id="cb13-8"><a href="#cb13-8"></a><span class="at">      </span><span class="fu">device_type</span><span class="kw">:</span><span class="at"> cisco_ios</span></span>
<span id="cb13-9"><a href="#cb13-9"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">hostname</span><span class="kw">:</span><span class="at"> DC1_CORE1</span></span>
<span id="cb13-10"><a href="#cb13-10"></a><span class="at">      </span><span class="fu">device_type</span><span class="kw">:</span><span class="at"> cisco_nxos</span></span>
<span id="cb13-11"><a href="#cb13-11"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">hostname</span><span class="kw">:</span><span class="at"> DC1_CORE2</span></span>
<span id="cb13-12"><a href="#cb13-12"></a><span class="at">      </span><span class="fu">device_type</span><span class="kw">:</span><span class="at"> cisco_nxos</span></span>
<span id="cb13-13"><a href="#cb13-13"></a><span class="fu">acl_name</span><span class="kw">:</span><span class="at"> LOCK_IT_DOWN</span></span>
<span id="cb13-14"><a href="#cb13-14"></a><span class="fu">acl_lines</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb13-15"><a href="#cb13-15"></a> remark Utility Server A</span>
<span id="cb13-16"><a href="#cb13-16"></a> permit ip host 192.168.1.100 any</span>
<span id="cb13-17"><a href="#cb13-17"></a> remark Allowed Subnet</span>
<span id="cb13-18"><a href="#cb13-18"></a> permit ip 192.168.10.0 0.0.0.255 any</span></code></pre></div>
<p>I hope this post has been both valuable and informative. If you have any questions or comments, please don’t hesitate to send me an <a href="mailto:brandon@neverthenetwork.com">email</a>.</p>
